  --- ATUALIZAÇÃO DO REAL 
	DECLARE @ANO_MES INT = CASE WHEN MONTH(GETDATE()) = 1 THEN CONCAT (YEAR(GETDATE())-1,12)
	                                                      ELSE CONCAT (YEAR(GETDATE()),'0',MONTH(GETDATE()) ) - 1 END
	DECLARE @COUNT_VERSAO INT 
	SELECT  @COUNT_VERSAO = COUNT(*) FROM TBL_DIM_COMPETENCIA 
	                        WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL'

	DECLARE @VERSAO_REAL CHAR(2) = CASE WHEN @COUNT_VERSAO = 0 THEN 'V1' 
													           ELSE  CONCAT ('V',CAST ((@COUNT_VERSAO+1) AS CHAR(1))) END
    UPDATE ST_DIM_COMPETENCIA
	SET PREVIA_FINAL = @VERSAO_REAL
	WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL' AND SIMULADO_OFICIAL = 'O'
	                                                
	INSERT INTO TBL_DIM_COMPETENCIA
	(CD_VERSAO,ANO_MES,ORCADO_REAL,SIMULADO_OFICIAL,PREVIA_FINAL)
	SELECT CD_VERSAO,ANO_MES,ORCADO_REAL,SIMULADO_OFICIAL,PREVIA_FINAL FROM ST_DIM_COMPETENCIA
	WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL' AND SIMULADO_OFICIAL = 'O' 

	DECLARE @ID_MAX_VERSAO_REAL INT 
	SELECT @ID_MAX_VERSAO_REAL = MAX(ID) FROM  TBL_DIM_COMPETENCIA WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL' AND SIMULADO_OFICIAL = 'O' 

	UPDATE TBL_DIM_COMPETENCIA
	SET PREVIA_FINAL = (SELECT CASE WHEN ID_STATUS = 1 THEN 'F' END 
	FROM    TBL_DIM_STATUS)
	WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL' AND SIMULADO_OFICIAL = 'O' AND ID = @ID_MAX_VERSAO_REAL

	SELECT  @COUNT_VERSAO = COUNT(*) FROM TBL_DIM_COMPETENCIA 
	                        WHERE ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL'

	UPDATE TBL_DIM_COMPETENCIA
	SET PREVIA_FINAL = CASE WHEN @COUNT_VERSAO = 0 THEN 'V1' 
												   ELSE  CONCAT ('V',CAST ((@COUNT_VERSAO-1) AS CHAR(1))) END
	WHERE (@ID_MAX_VERSAO_REAL-1) = ID AND ANO_MES = @ANO_MES AND ORCADO_REAL = 'REAL'

	 --- ATUALIZAÇÃO DO ORÇADO
	 UPDATE TBL_DIM_COMPETENCIA
	 SET CD_VERSAO = A.CD_VERSAO, 
	     SIMULADO_OFICIAL = A.SIMULADO_OFICIAL,
		 PREVIA_FINAL = 'F'
	FROM ST_DIM_COMPETENCIA A LEFT JOIN TBL_DIM_COMPETENCIA B
	ON  A.ANO_MES = B.ANO_MES AND A.ORCADO_REAL = B.ORCADO_REAL
	WHERE A.CD_VERSAO <> B.CD_VERSAO  AND A.SIMULADO_OFICIAL = 'O' AND A.ORCADO_REAL = 'ORCADO' AND 
	A.ANO_MES > CAST (CONCAT(CAST (YEAR(GETDATE()) AS CHAR(4)),'00') AS INT)
